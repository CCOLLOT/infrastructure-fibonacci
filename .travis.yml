language: generic 
services:
    - docker
before_install:
    - docker build -t ccollot/terraformfib --build-arg AWS_KEY_ID_FIB="$AWS_KEY_ID_FIB"  --build-arg AWS_SECRET_KEY_FIB="$AWS_SECRET_KEY_FIB"  -f ./Dockerfile .

script:
    - docker run -it --entrypoint '/bin/sh' -e AWS_ACCESS_KEY_ID -e AWS_SECRET_ACCESS_KEY -e TF_VAR_POSTGRES_USERNAME -e TF_VAR_POSTGRES_PASSWORD ccollot/terraformfib build.sh

after_success:
    - docker run -it ccollot/terraformfib apply -auto-approve